```python
import hashlib
import ssl
import socket
import logging
import re

def certificate_matches(certificate, known_hash, ca_certs_path, hostname):
    '''
    Return true if the certificate matches the known_hash, AND is validated against the CA, AND matches the hostname.

    :param certificate: certificate in PEM format (string).  Must be a valid PEM encoded certificate.
    :param known_hash: known hash (string) in hexadecimal format.
    :param ca_certs_path: Path to a file containing trusted CA certificates in PEM format.
    :param hostname: The hostname to verify the certificate against.
    :return: true if the certificate matches the known_hash, is validated, and the hostname matches, False otherwise.  Returns False if the certificate is invalid or the hash is not a valid hex string.
    '''
    try:
        # Input Validation: Hostname
        if not re.match(r"^[a-zA-Z0-9.-]+$", hostname):
            logging.error("Invalid hostname format.")
            return False

        # Validate the certificate is a valid PEM encoded certificate.  This is crucial to prevent injection attacks.
        try:
            ssl.PEM_cert_to_DER_cert(certificate.encode('utf-8'))  # Raises ValueError if invalid PEM
        except ValueError:
            logging.error("Error: Invalid certificate format.")
            return False

        # Calculate the SHA-256 hash of the certificate.  SHA-256 is generally preferred for security.
        try:
            cert_hash = hashlib.sha256(certificate.encode('utf-8')).hexdigest()
        except Exception as e:
            logging.exception(f"Error calculating certificate hash: {e}")
            return False

        # Compare the calculated hash with the known hash.  Case-insensitive comparison is recommended.
        hash_matches = cert_hash.lower() == known_hash.lower()

        # Perform full certificate chain validation and hostname verification
        try:
            context = ssl.create_default_context(cafile=ca_certs_path)
            context.check_hostname = True  # Enable hostname verification
            context.verify_mode = ssl.CERT_REQUIRED  # Require certificate verification
            context.minimum_version = ssl.TLSVersion.TLSv1_2 # Enforce TLS 1.2 or higher
            context.set_ciphers('DEFAULT:!aNULL:!eNULL:!LOW:!EXPORT:!SSLv2') # Disable insecure ciphers

            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
                sock.settimeout(5)  # Set a timeout to prevent hanging
                try:
                    sock.connect((hostname, 443))
                except socket.timeout:
                    logging.error("Socket timeout during connection.")
                    return False
                except socket.gaierror as e:
                    logging.error(f"Socket Error: {e}")
                    return False

                with context.wrap_socket(sock, server_hostname=hostname) as ssock:
                    try:
                        ssock.do_handshake()
                        # ssl.match_hostname(ssock.getpeercert(), hostname) # Redundant hostname verification - removed
                        return hash_matches
                    except ssl.SSLError as e:
                        logging.error(f"SSL Handshake Error: {e}")
                        return False
                    except ssl.CertificateError as e:
                        logging.error(f"Hostname verification failed: {e}")
                        return False
                    except Exception as e:
                        logging.exception("Unexpected error during SSL handshake")
                        return False

        except FileNotFoundError:
            logging.error(f"Error: CA certificates file not found at {ca_certs_path}")
            return False
        except ssl.SSLError as e:
            logging.error(f"SSL Error: {e}")
            return False
        except ValueError as e:
            logging.error(f"Value Error: {e}")
            return False
        except Exception as e:
            logging.exception("Unexpected error during certificate verification")
            return False

    except Exception as e:
        logging.exception(f"Error during hash comparison: {e}")
        return False


# Example Usage (Demonstration and Testing)
if __name__ == '__main__':
    logging.basicConfig(level=logging.ERROR, filename="cert_validation.log", format='%(asctime)s - %(levelname)s - %(message)s')

    # Example 1: Matching certificate and hash
    valid_certificate = """-----BEGIN CERTIFICATE-----
MIIDZTCCAk2gAwIBAgIJAJtxa1Y01v+AMA0GCSqGSIb3DQEBCwUAMIIDATEL
MAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRcwFQYDVQQHDA5TYW50YSBDbGFy
YTAeFw0yMzEyMDgxNzQ0MzNaFw0yNDEyMDcxNzQ0MzNaMIIDATELMAkGA1UE
BhMCVVMxCzAJBgNVBAgMAkNBMRcwFQYDVQQHDA5TYW50YSBDbGFyYTCCAiIw
DQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAL+19+04+494444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444
444444444444444444444444444444444444444444444444444444444444

